% Template for a bar graph
%
% Author: Zengwen Yuan
% Version: 1.0  2017-03-08 init version
% Note: to use package fontspec,
% use XeLaTeX to compile

\documentclass{article}

% \usepackage{tikz}
\usepackage{pgfplots}
\usepackage{verbatim}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{0pt}
\usetikzlibrary{patterns}
\usepackage{pgfplotstable}

\usepackage{fontspec}
\setmainfont[
BoldFont={Helvetica Neue Bold},
ItalicFont={Helvetica Neue Italic},
BoldItalicFont={Helvetica Neue Bold Italic}
]{Helvetica Neue}

% node    mean
% # paxos1.txt
\pgfplotstableread{
x y        min         max
eNB     267.5519    13.3760     456.3312
GW      272.3943    18.5670     461.3182
MME     269.9535    15.9512     458.6576
}{\paxosi}

% # paxos2.txt
\pgfplotstableread{
x y        min         max
eNB     354.4938    28.3651     528.0648
GW      349.6514    23.7386     523.4980
MME     352.0923    26.0935     525.8016
}{\paxosii}


\pgfplotsset{
    compat=newest,
    /pgfplots/ybar legend/.style={
        /pgfplots/legend image code/.code={%
        %\draw[##1,/tikz/.cd,yshift=-0.25em]
                %(0cm,0cm) rectangle (3pt,0.8em);},
        \draw[##1,/tikz/.cd,bar width=8pt,yshift=-0.2em,bar shift=2pt]
                plot coordinates {(0cm,0.5em)};},
    },
}

\begin{document}

\begin{tikzpicture}
\begin{axis}[
    % line width = 1pt,
    ybar,
    ymax    = 800,
    ymin    = 0,
    width   = 9 cm,
    height  = 2 cm,
    % x=2cm, % Distance between the centers of the bars
    % enlarge x limits= auto,
    enlarge x limits={abs=1cm}, % The distance between the center of the first bar and the left edge
    scale only axis = true,
    % xtick={1,2,3},
    % xticklabels from table={\paxosi}{[index]0},
    xtick align = inside,
    bar width   = 10 pt,
    xticklabel style = {
        % font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        % xshift=-1ex,
        % yshift = 2pt,
    },
    yticklabel style = {
        font=\small,
        xshift = 2pt,
        yshift = -3pt,
    },
    tick label style={/pgf/number format/assume math mode=true},
    % ytick = {0, 100, ..., 400},
    % xticklabel pos=right,
    xtick pos = left,
    ytick pos = left,
    % yticklabel pos=right,
    % enlargelimits=0.15,
    legend style={
        at      = {(0.02, 1)},
        font    = \small,
        fill    = none,
        draw    = none,
        /tikz/every even column/.append style={column sep=0.5cm},
        anchor  = north west,
        legend cell align   = left,
        legend columns      = 2,
    },
    % ylabel = {\begin{tabular}{cc}Atomic consistency\\overhead (\%)\end{tabular}},
    ylabel={\begin{tabular}{cc}Concensus\\time (ms)\end{tabular}},
    ylabel style={
        font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        % xshift=-1ex,
        yshift = -5 pt,
    },
    symbolic x coords={eNB, GW, MME},
    % xticklabels={AT\&T, T-Mobile, Sprint, China Mobile, Google-Fi},
    xtick=data,
    % nodes near coords,
    % nodes near coords align={vertical},
    ]

\addplot+[pattern = north east lines, pattern color = blue!50, line width = 0.8pt]
  plot[
      error bars/.cd,
      y dir=both,
      y explicit,
      error bar style = {
          line width = 1pt
      },
      error mark options = {
            rotate = 90,
            % red,
            mark size = 2pt,
            line width = 1pt,
      },
    ]
    table[
        % x expr = \thisrow{node},
        % y expr = \thisrow{mean},
        % y error plus expr = \thisrow{max} - \thisrow{mean},
        % y error minus expr = \thisrow{mean} - \thisrow{min},
        x = x,
        y = y,
        y error plus expr=\thisrow{max} - \thisrow{y},
        y error minus expr=\thisrow{y} - \thisrow{min}
    ] {\paxosi};

\addplot+[line width = 0.8pt]
  plot[
      error bars/.cd,
      y dir=both,
      y explicit,
      error bar style = {
          line width = 1pt
      },
      error mark options = {
            rotate = 90,
            % red,
            mark size = 2pt,
            line width = 1pt,
      },
    ]
    table[
        x = x,
        y = y,
        y error plus expr=\thisrow{max} - \thisrow{y},
        y error minus expr=\thisrow{y} - \thisrow{min}
    ] {\paxosii};


\legend{Round-I Consensus, Round-II Consensus};
\end{axis}
\end{tikzpicture}

\end{document}
